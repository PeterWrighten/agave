<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶æ„æ·±åº¦è§£æ - Agave Validator Documentation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒªï¸</text></svg>">
</head>
<body>
    <div class="container">
        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput">
            <a href="index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        </div>

        <!-- Header -->
        <header class="header">
            <h1>ğŸ—ï¸ æ¶æ„æ·±åº¦è§£æ</h1>
            <p class="subtitle">æ·±å…¥ç†è§£AgaveéªŒè¯å™¨çš„æ ¸å¿ƒæ¶æ„è®¾è®¡</p>
        </header>

        <!-- Overview -->
        <div class="content">
            <h2>ğŸ“Š ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</h2>
            <p>AgaveéªŒè¯å™¨é‡‡ç”¨é«˜åº¦æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p>
            
            <div class="architecture-grid">
                <div class="component-card">
                    <h3>ğŸ”„ TPU (Transaction Processing Unit)</h3>
                    <ul>
                        <li>äº¤æ˜“æ¥æ”¶ä¸é¢„å¤„ç†</li>
                        <li>ç­¾åéªŒè¯ä¸è¿‡æ»¤</li>
                        <li>äº¤æ˜“æ‰“åŒ…ä¸æ’åº</li>
                        <li>è½¬å‘åˆ°å…¶ä»–éªŒè¯èŠ‚ç‚¹</li>
                    </ul>
                </div>

                <div class="component-card">
                    <h3>ğŸ“¦ TVU (Transaction Validation Unit)</h3>
                    <ul>
                        <li>åŒºå—éªŒè¯ä¸é‡æ”¾</li>
                        <li>çŠ¶æ€æ›´æ–°å¤„ç†</li>
                        <li>æŠ•ç¥¨ç”Ÿæˆä¸å¹¿æ’­</li>
                        <li>è´¦æˆ·æ•°æ®åŒæ­¥</li>
                    </ul>
                </div>

                <div class="component-card">
                    <h3>ğŸ’¾ AccountsDB</h3>
                    <ul>
                        <li>è´¦æˆ·çŠ¶æ€å­˜å‚¨</li>
                        <li>å¿«ç…§ç®¡ç†</li>
                        <li>å¢é‡æ›´æ–°</li>
                        <li>åƒåœ¾å›æ”¶</li>
                    </ul>
                </div>

                <div class="component-card">
                    <h3>âš¡ SVM Runtime</h3>
                    <ul>
                        <li>æ™ºèƒ½åˆçº¦æ‰§è¡Œ</li>
                        <li>å¹¶è¡Œå¤„ç†è°ƒåº¦</li>
                        <li>å®‰å…¨æ²™ç®±</li>
                        <li>æŒ‡ä»¤éªŒè¯</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- TPU Pipeline -->
        <div class="content">
            <h2>ğŸ”„ TPUæµæ°´çº¿è¯¦è§£</h2>
            
            <div class="pipeline-section">
                <h3>1. äº¤æ˜“æ¥æ”¶å±‚</h3>
                <pre><code>// File: core/src/tpu/forward_stage.rs
// TPU Forward Stage
struct ForwardStage {
    packet_receiver: PacketReceiver,
    forward_socket: UdpSocket,
    cluster_info: Arc<ClusterInfo>,
}</code></pre>
                <ul>
                    <li>UDPæ•°æ®åŒ…æ¥æ”¶ä¸è§£æ</li>
                    <li>åŸºæœ¬æ ¼å¼éªŒè¯</li>
                    <li>é‡å¤äº¤æ˜“è¿‡æ»¤</li>
                    <li>ç½‘ç»œè½¬å‘é€»è¾‘</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>2. ç­¾åéªŒè¯å±‚</h3>
                <pre><code>// File: core/src/tpu/verify_stage.rs
// Signature Verification
struct VerifyStage {
    verifier: TransactionVerifier,
    verified_sender: VerifiedSender,
    stats: VerifyStats,
}</code></pre>
                <ul>
                    <li>Ed25519ç­¾åéªŒè¯</li>
                    <li>å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†</li>
                    <li>éªŒè¯ç»“æœç¼“å­˜</li>
                    <li>æ€§èƒ½ç»Ÿè®¡</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>3. äº¤æ˜“æ‰“åŒ…å±‚</h3>
                <pre><code>// File: core/src/banking_stage.rs
// Banking Stage
struct BankingStage {
    bank_forks: Arc<RwLock<BankForks>>,
    scheduler: Arc<CentralScheduler>,
    poh_recorder: Arc<RwLock<PohRecorder>>,
}</code></pre>
                <ul>
                    <li>äº¤æ˜“æ’åºä¸åˆ†ç»„</li>
                    <li>è´¹ç”¨è®¡ç®—</li>
                    <li>åŒºå—ç”Ÿæˆ</li>
                    <li>ä¸­å¤®è°ƒåº¦å™¨é›†æˆ</li>
                </ul>
            </div>
        </div>

        <!-- TVU Pipeline -->
        <div class="content">
            <h2>ğŸ“¦ TVUæµæ°´çº¿è¯¦è§£</h2>
            
            <div class="pipeline-section">
                <h3>1. åŒºå—éªŒè¯</h3>
                <pre><code>// File: core/src/tvu/block_verification_stage.rs
// Block Verification
struct BlockVerificationStage {
    verified_receiver: VerifiedReceiver,
    retransmit_sender: RetransmitSender,
    vote_sender: VoteSender,
}</code></pre>
                <ul>
                    <li>åŒºå—å“ˆå¸ŒéªŒè¯</li>
                    <li>çˆ¶åŒºå—å…³è”</li>
                    <li>æ—¶é—´æˆ³æ£€æŸ¥</li>
                    <li>é‡æ”¾ä¿æŠ¤</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>2. çŠ¶æ€å¤„ç†</h3>
                <pre><code>// File: core/src/replay_stage.rs
// State Processing
struct ReplayStage {
    bank_forks: Arc<RwLock<BankForks>>,
    progress: Arc<RwLock<ProgressMap>>,
    accounts_background_request_sender: AbsRequestSender,
}</code></pre>
                <ul>
                    <li>äº¤æ˜“é‡æ”¾</li>
                    <li>çŠ¶æ€æ›´æ–°</li>
                    <li>åˆ†å‰å¤„ç†</li>
                    <li>æŠ•ç¥¨ç”Ÿæˆ</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>3. è´¦æˆ·åŒæ­¥</h3>
                <pre><code>// File: runtime/src/accounts_background_service.rs
// Accounts Background Service
struct AccountsBackgroundService {
    accounts_db: Arc<AccountsDb>,
    snapshot_request_handler: SnapshotRequestHandler,
    accounts_cache: Arc<AccountsCache>,
}</code></pre>
                <ul>
                    <li>å¢é‡åŒæ­¥</li>
                    <li>å¿«ç…§ç®¡ç†</li>
                    <li>å­˜å‚¨ä¼˜åŒ–</li>
                    <li>ç¼“å­˜æ›´æ–°</li>
                </ul>
            </div>
        </div>

        <!-- SVM Runtime -->
        <div class="content">
            <h2>âš¡ SVMè¿è¡Œæ—¶æ¶æ„</h2>
            
            <div class="runtime-section">
                <h3>æ‰§è¡Œå¼•æ“</h3>
                <pre><code>// File: runtime/src/svm/program_executor.rs
// Program Executor
struct ProgramExecutor {
    program_cache: Arc<RwLock<ProgramCache>>,
    syscall_registry: SyscallRegistry,
    compute_budget: ComputeBudget,
}</code></pre>
                <ul>
                    <li>æŒ‡ä»¤è§£æä¸æ‰§è¡Œ</li>
                    <li>ç³»ç»Ÿè°ƒç”¨å¤„ç†</li>
                    <li>èµ„æºé™åˆ¶æ§åˆ¶</li>
                    <li>é”™è¯¯å¤„ç†æœºåˆ¶</li>
                </ul>
            </div>

            <div class="runtime-section">
                <h3>å¹¶è¡Œè°ƒåº¦å™¨</h3>
                <pre><code>// File: unified-scheduler-pool/src/lib.rs
// Central Scheduler
struct CentralScheduler {
    thread_pool: ThreadPool,
    dependency_analyzer: DependencyAnalyzer,
    execution_timing: ExecutionTiming,
}</code></pre>
                <ul>
                    <li>äº¤æ˜“ä¾èµ–åˆ†æ</li>
                    <li>å¹¶è¡Œæ‰§è¡Œè°ƒåº¦</li>
                    <li>èµ„æºåˆ†é…</li>
                    <li>æ€§èƒ½ç›‘æ§</li>
                </ul>
            </div>

            <div class="runtime-section">
                <h3>å®‰å…¨æ²™ç®±</h3>
                <pre><code>// File: runtime/src/svm/security.rs
// Security Sandbox
struct SecuritySandbox {
    memory_mapper: MemoryMapper,
    instruction_meter: InstructionMeter,
    syscall_context: SyscallContext,
}</code></pre>
                <ul>
                    <li>å†…å­˜éš”ç¦»</li>
                    <li>æŒ‡ä»¤è®¡é‡</li>
                    <li>ç³»ç»Ÿè°ƒç”¨é™åˆ¶</li>
                    <li>èµ„æºæ§åˆ¶</li>
                </ul>
            </div>
        </div>

        <!-- Performance Optimizations -->
        <div class="content">
            <h2>ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡</h2>
            
            <div class="optimization-section">
                <h3>1. ä¸­å¤®è°ƒåº¦å™¨</h3>
                <div class="alert alert-info">
                    <strong>æ ¸å¿ƒåˆ›æ–°:</strong> v1.18å¼•å…¥çš„ä¸­å¤®è°ƒåº¦å™¨æ˜¾è‘—æå‡äº†äº¤æ˜“å¤„ç†æ€§èƒ½
                </div>
                <ul>
                    <li>æ™ºèƒ½ä¾èµ–åˆ†æ</li>
                    <li>åŠ¨æ€çº¿ç¨‹æ± ç®¡ç†</li>
                    <li>è‡ªé€‚åº”æ‰¹å¤„ç†</li>
                    <li>è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>2. å†…å­˜ç®¡ç†</h3>
                <div class="alert alert-success">
                    <strong>ä¼˜åŒ–é‡ç‚¹:</strong> ç²¾ç»†çš„å†…å­˜ç®¡ç†æœºåˆ¶ç¡®ä¿é«˜æ•ˆçš„èµ„æºåˆ©ç”¨
                </div>
                <ul>
                    <li>è´¦æˆ·ç¼“å­˜ä¼˜åŒ–</li>
                    <li>é›¶æ‹·è´æŠ€æœ¯</li>
                    <li>å†…å­˜æ± å¤ç”¨</li>
                    <li>åƒåœ¾å›æ”¶ç­–ç•¥</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>3. ç½‘ç»œä¼˜åŒ–</h3>
                <div class="alert alert-warning">
                    <strong>å…³é”®è®¾è®¡:</strong> é«˜æ•ˆçš„ç½‘ç»œä¼ è¾“åè®®ç¡®ä¿å¿«é€Ÿçš„èŠ‚ç‚¹é—´é€šä¿¡
                </div>
                <ul>
                    <li>QUICåè®®ä¼˜åŒ–</li>
                    <li>æ•°æ®åŒ…èšåˆ</li>
                    <li>æµé‡æ§åˆ¶</li>
                    <li>æ‹¥å¡å¤„ç†</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>AgaveéªŒè¯å™¨æ–‡æ¡£ä¸­å¿ƒ â€¢ ä¸ºSolanaç”Ÿæ€å¼€å‘å’ŒéªŒè¯å™¨è¿è¥è€Œåˆ›å»º</p>
            <p>ğŸŒªï¸ åŠ©åŠ›æ„å»ºé«˜æ€§èƒ½åŒºå—é“¾ç½‘ç»œï¼Œæ”¯æ’‘Web3æœªæ¥</p>
        </footer>

        <!-- Theme Toggle Button -->
        <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢æ·±è‰²æ¨¡å¼">
            ğŸŒ“
        </button>
    </div>

    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && prefersDarkScheme.matches)) {
            document.body.classList.add('dark-theme');
        }

        themeToggle.addEventListener('click', toggleTheme);
        prefersDarkScheme.addListener((e) => {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
            }
        });

        // Add copy functionality to code blocks
        document.querySelectorAll('pre code').forEach(block => {
            block.addEventListener('click', function() {
                navigator.clipboard.writeText(this.textContent).then(() => {
                    const pre = this.parentElement;
                    const originalBorder = pre.style.borderColor;
                    pre.style.borderColor = 'var(--success-green)';
                    setTimeout(() => {
                        pre.style.borderColor = originalBorder;
                    }, 1000);
                });
            });
        });

        // Add loading indicator for navigation
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                if (!this.href.startsWith('#')) {
                    const loading = document.createElement('div');
                    loading.className = 'loading';
                    this.appendChild(loading);
                }
            });
        });
    </script>
</body>
</html>
