<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开发指南 - Agave Validator Documentation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌪️</text></svg>">
</head>
<body>
    <div class="container">
        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="搜索文档..." id="searchInput">
            <a href="index.html" class="back-link">← 返回首页</a>
        </div>

        <!-- Header -->
        <header class="header">
            <h1>💻 开发指南</h1>
            <p class="subtitle">Agave验证器开发贡献与扩展的完整指南</p>
        </header>

        <!-- Overview -->
        <div class="content">
            <h2>🎯 开发概览</h2>
            <p>Agave验证器作为Solana网络的核心组件，为开发者提供了丰富的贡献机会。无论是核心协议改进、性能优化还是插件开发，都有清晰的开发流程和最佳实践。</p>
            
            <div class="alert alert-info">
                <strong>开发环境:</strong> Agave基于Rust语言开发，采用现代化的开发工具链和CI/CD流程
            </div>
        </div>

        <!-- Getting Started -->
        <div class="content">
            <h2>🚀 快速开始</h2>
            
            <div class="pipeline-section">
                <h3>1. 开发环境设置</h3>
                <p>配置完整的Agave开发环境，包括Rust工具链、依赖库和开发工具。</p>
                <pre><code># 安装Rust工具链
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# 安装必要组件
rustup component add rustfmt clippy
rustup toolchain install nightly

# 克隆Agave仓库
git clone https://github.com/anza-xyz/agave.git
cd agave

# 安装开发依赖
./scripts/cargo-install-all.sh</code></pre>
                <ul>
                    <li><strong>Rust工具链:</strong> 最新稳定版和nightly版本</li>
                    <li><strong>开发工具:</strong> rustfmt、clippy、IDE插件</li>
                    <li><strong>测试环境:</strong> 本地测试网络配置</li>
                    <li><strong>CI工具:</strong> GitHub Actions工作流</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>2. 项目结构</h3>
                <div class="alert alert-success">
                    <strong>代码组织:</strong> Agave采用模块化设计，便于理解和贡献
                </div>
                <pre><code>agave/
├── core/           # 核心验证器逻辑
├── runtime/        # SVM运行时
├── ledger/         # 账本存储与管理
├── rpc/           # RPC服务接口
├── gossip/        # 网络通信协议
├── poh/           # Proof of History
├── streamer/      # 网络数据流
├── banking-stage/ # 交易处理流水线
├── tpu/           # 交易处理单元
├── tvu/           # 交易验证单元
└── programs/      # 内置程序</code></pre>
                <ul>
                    <li>核心验证器组件</li>
                    <li>网络协议栈</li>
                    <li>存储系统</li>
                    <li>RPC接口层</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>3. 构建与测试</h3>
                <pre><code># 完整构建
cargo build --release

# 运行测试套件
cargo test

# 运行特定测试
cargo test --package solana-core --test test_name

# 性能基准测试
cargo bench</code></pre>
                <ul>
                    <li>增量编译优化</li>
                    <li>并行测试执行</li>
                    <li>性能回归检测</li>
                    <li>代码覆盖率分析</li>
                </ul>
            </div>
        </div>

        <!-- Contribution Workflow -->
        <div class="content">
            <h2>🔄 贡献流程</h2>
            
            <div class="optimization-section">
                <h3>1. Fork与分支管理</h3>
                <pre><code># Fork仓库并克隆
git clone https://github.com/your-username/agave.git
cd agave

# 添加上游仓库
git remote add upstream https://github.com/anza-xyz/agave.git

# 创建功能分支
git checkout -b feature/your-feature-name

# 保持分支最新
git fetch upstream
git rebase upstream/master</code></pre>
                <ul>
                    <li><strong>分支命名:</strong> feature/、fix/、docs/ 前缀</li>
                    <li><strong>提交消息:</strong> 清晰描述变更内容</li>
                    <li><strong>变更范围:</strong> 单一职责原则</li>
                    <li><strong>代码质量:</strong> 通过所有检查</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>2. 代码规范</h3>
                <div class="alert alert-warning">
                    <strong>代码质量:</strong> 遵循Rust最佳实践和项目特定的编码规范
                </div>
                <pre><code># 代码格式化
cargo fmt

# 静态分析
cargo clippy -- -D warnings

# 文档生成
cargo doc --no-deps

# 安全审计
cargo audit</code></pre>
                <ul>
                    <li>Rust官方风格指南</li>
                    <li>Clippy静态分析</li>
                    <li>API文档完整性</li>
                    <li>安全最佳实践</li>
                </ul>
            </div>

            <div class="pipeline-section">
                <h3>3. Geyser插件开发</h3>
                <p>Geyser插件系统允许开发者订阅账户变更、交易和区块数据，实现实时数据处理。</p>
                <pre><code>use solana_geyser_plugin_interface::geyser_plugin_interface::{
    GeyserPlugin, GeyserPluginError, Result as PluginResult,
};

pub struct MyGeyserPlugin {
    // 插件状态
}

impl GeyserPlugin for MyGeyserPlugin {
    fn name(&self) -> &'static str {
        "my-geyser-plugin"
    }
    
    fn on_load(&mut self, config_file: &str) -> PluginResult<()> {
        // 插件初始化
        Ok(())
    }
    
    fn update_account(
        &mut self,
        account: ReplicaAccountInfoVersions,
        slot: Slot,
        is_startup: bool,
    ) -> PluginResult<()> {
        // 处理账户更新
        Ok(())
    }
}</code></pre>
                <ul>
                    <li><strong>接口实现:</strong> GeyserPlugin trait</li>
                    <li><strong>事件处理:</strong> 账户、交易、区块事件</li>
                    <li><strong>配置管理:</strong> JSON配置文件</li>
                    <li><strong>错误处理:</strong> 插件异常管理</li>
                </ul>
            </div>
        </div>

        <!-- Testing Framework -->
        <div class="content">
            <h2>🧪 测试框架</h2>
            
            <div class="optimization-section">
                <h3>1. 单元测试</h3>
                <p>Agave采用Rust内置测试框架，支持并行测试和精确的断言。</p>
                <pre><code>#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_transaction_processing() {
        // 测试交易处理逻辑
        let tx = create_test_transaction();
        let result = process_transaction(&tx);
        assert!(result.is_ok());
    }
    
    #[test]
    #[ignore] // 长时间运行的测试
    fn test_performance_benchmark() {
        // 性能基准测试
    }
}</code></pre>
                <ul>
                    <li><strong>测试组织:</strong> 模块内测试和集成测试</li>
                    <li><strong>Mock对象:</strong> 外部依赖的模拟</li>
                    <li><strong>并发测试:</strong> 多线程安全性验证</li>
                    <li><strong>错误路径:</strong> 异常情况处理测试</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>2. 集成测试</h3>
                <div class="alert alert-info">
                    <strong>端到端测试:</strong> 验证组件间的协作和系统级功能
                </div>
                <pre><code># 启动测试验证器
solana-test-validator --reset

# 运行集成测试
cargo test --package solana-local-cluster --test local_cluster

# 网络测试
cargo test --package solana-gossip --test test_gossip_integration</code></pre>
                <ul>
                    <li>本地集群测试</li>
                    <li>网络协议测试</li>
                    <li>共识机制验证</li>
                    <li>RPC接口测试</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>3. 调试技术</h3>
                <pre><code># 设置日志级别
export RUST_LOG=solana_core=debug,solana_banking_stage=trace

# 启动验证器（调试模式）
solana-validator --log - --log-level debug

# GDB调试
gdb ./target/release/solana-validator
(gdb) run --ledger /tmp/ledger</code></pre>
                <ul>
                    <li><strong>分级日志:</strong> error、warn、info、debug、trace</li>
                    <li><strong>交互式调试:</strong> GDB、LLDB调试器</li>
                    <li><strong>性能分析:</strong> perf、valgrind工具</li>
                    <li><strong>内存检查:</strong> AddressSanitizer、Miri</li>
                </ul>
            </div>
        </div>

        <!-- Best Practices -->
        <div class="content">
            <h2>🎯 最佳实践</h2>
            
            <div class="optimization-section">
                <h3>1. 代码质量</h3>
                <ul>
                    <li><strong>单一职责:</strong> 每个函数专注单一功能</li>
                    <li><strong>错误处理:</strong> 完善的错误传播机制</li>
                    <li><strong>类型安全:</strong> 充分利用Rust类型系统</li>
                    <li><strong>性能考虑:</strong> 避免不必要的内存分配</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>2. 协作规范</h3>
                <ul>
                    <li><strong>PR模板:</strong> 详细描述变更内容和影响</li>
                    <li><strong>代码审查:</strong> 关注安全性和性能影响</li>
                    <li><strong>测试覆盖:</strong> 新功能必须包含测试</li>
                    <li><strong>文档更新:</strong> 同步更新相关文档</li>
                </ul>
            </div>

            <div class="optimization-section">
                <h3>3. 社区参与</h3>
                <ul>
                    <li><strong>Discord讨论:</strong> 技术问题和设计讨论</li>
                    <li><strong>GitHub Issues:</strong> Bug报告和功能请求</li>
                    <li><strong>技术博客:</strong> 分享开发经验和见解</li>
                    <li><strong>会议演讲:</strong> 推广技术创新成果</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Agave验证器文档中心 • 为Solana生态开发和验证器运营而创建</p>
            <p>🌪️ 助力构建高性能区块链网络，支撑Web3未来</p>
        </footer>

        <!-- Theme Toggle Button -->
        <button class="theme-toggle" id="themeToggle" aria-label="切换深色模式">
            🌓
        </button>
    </div>

    <script>
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const sections = document.querySelectorAll('.content, .pipeline-section, .optimization-section');
            
            sections.forEach(section => {
                const text = section.textContent.toLowerCase();
                if (text.includes(searchTerm) || searchTerm === '') {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
        });

        // Load saved theme
        if (localStorage.getItem('darkTheme') === 'true') {
            document.body.classList.add('dark-theme');
        }

        // Copy code functionality
        document.querySelectorAll('pre code').forEach(block => {
            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = '复制';
            button.addEventListener('click', function() {
                navigator.clipboard.writeText(block.textContent);
                button.textContent = '已复制!';
                setTimeout(() => button.textContent = '复制', 2000);
            });
            block.parentNode.appendChild(button);
        });

        // Add loading indicator for navigation
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                if (!this.href.startsWith('#')) {
                    const loading = document.createElement('div');
                    loading.className = 'loading';
                    this.appendChild(loading);
                }
            });
        });
    </script>
</body>
</html> 